# Viral Analyzer

Viral Analyzer is a Python program for analyzing viral escape prediction data generated by various Protein Language Models (PLMs).  
This code is tested with Python >= 3.10.

## Features

- **Strain Selection:** Analyze escape data for any wild type (original) viral strain, with support for wildcard matching.
- **Ablation Experiments:** Perform control experiments using randomly generated semantic and grammaticality scores.
- **Evolutionary Time Analysis:** Calculate mutation scores across specified evolutionary time schedules.
- **Ternary Plot Visualization:** Export ternary plots of mean escape ranks for different time points and resolutions.
- **Minimizer Search:** Find optimal barycentric weights and minimum mean escape ranks over a time interval, with visualization.

## Directory Structure

```
├── main.py
├── metadata/
│   ├── virus_strains/
│   └── model_results/
├── data/
│   └── model_results/
└── requirements.txt
```

- **metadata/virus_strains/**: Metadata for available virus strains (editable).
- **metadata/model_results/**: Metadata for PLM result files (editable).
- **data/model_results/**: PLM result files.
- **outputs/**: Standard analysis outputs.
- **outputs-ablation/**: Results from ablation experiments.
- **outputs-figures/**: Exported figures (e.g., ternary plots).

## Usage

This program accepts various command-line arguments:

- `--escape`  
  Specifies the wild type (original) strain of the virus.  
  Use `--help` to see the list of available strains.  
  Appending an asterisk (`*`) at the end enables wildcard matching.  
  You can modify strain metadata under the `metadata/virus_strains/` subdirectory.

- `--result`  
  Specifies the PLM result(s) to use for analysis.  
  Supports the wildcard character `*`.  
  Result files are stored under `data/model_results/`, and their metadata can be edited in `metadata/model_results/`.

- `--ablation`  
  Performs an ablation control experiment using randomly generated semantic and grammaticality scores.  
  Use `--repeat` to set the number of repetitions.  
  Results are saved in the `outputs-ablation/` directory.

- `--scores`  
  Calculates mutation scores at the specified evolutionary time schedule.  
  Outputs are saved in the `outputs/` directory.

- `--ternary`  
  Exports ternary plots of the mean escape rank for the specified evolutionary time schedule and resolution.  
  Use `--times` and `--res` to specify time points and resolution.  
  Figures are saved in the `outputs-figures/` directory.

- `--minimizer`  
  Searches for optimal barycentric weights and minimum mean escape rank over a specified time interval, and exports minimizer ternary plots.  
  Accepts three optional values: `t0, t1, num_points`.

- `--help`  
  Displays available strains, result files, and additional options.

## Example

Export minimizer plots for the SARS-CoV-2 wildtype sequence using the ESM-3B model with L1-distance:

```bash
python main.py --escape "SARS-CoV-2-WildType>*" --result "SARS-CoV-2-WildType-ESM-3B-L1" --minimizer
```

Perform an ablation experiment with 100 repetitions:

```bash
python main.py --escape "SARS-CoV-2-WildType>*" --result "SARS-CoV-2-WildType-Random" --ablation --repeat 100
```

## Notes

- You can edit or add new strains and PLM result metadata in the `metadata/` subdirectories.
- All output files and figures are saved in their respective `outputs*` directories.
- For more details on available options and usage, run:
  ```bash
  python main.py --help
  ```
